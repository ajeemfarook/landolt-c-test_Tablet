<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Landolt C</title>
  <style>
    body { margin:0; padding:0; background:#000; overflow:hidden; height:100vh; }
    canvas { display:block; width:100%; height:100%; }
  </style>
</head>
<body>
  <canvas id="c"></canvas>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const canvas = document.getElementById('c');
    const ctx = canvas.getContext('2d');

    let currentDistM = 1.30;
    let contrast = 1.0;
    let orientation = 0;
    const TARGET_GAP_ARCMIN = 50.0;   // exactly your conclusion value
    const ppi = 380;                  // â† CHANGE THIS to your tablet's real PPI

    function resize() {
      canvas.width = window.innerWidth * devicePixelRatio;
      canvas.height = window.innerHeight * devicePixelRatio;
      canvas.style.width = window.innerWidth + 'px';
      canvas.style.height = window.innerHeight + 'px';
      draw();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const cx = canvas.width / 2, cy = canvas.height / 2;

      const gapRad = (TARGET_GAP_ARCMIN / 60) * (Math.PI / 180);
      const gapPhysicalM = 2 * currentDistM * Math.tan(gapRad / 2);
      const gapPx = gapPhysicalM * ppi * 39.3701;

      const outerDiameterPx = gapPx * 5;
      const strokePx = outerDiameterPx / 5;
      const radiusOuter = outerDiameterPx / 2;
      const radiusInner = radiusOuter - strokePx;

      ctx.save();
      ctx.translate(cx, cy);
      ctx.rotate(orientation * Math.PI / 180);
      ctx.globalAlpha = contrast;

      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(0, 0, radiusOuter, 0, Math.PI * 2);
      ctx.arc(0, 0, radiusInner, Math.PI * 2, 0, true);
      ctx.fill('evenodd');

      ctx.globalCompositeOperation = 'destination-out';
      ctx.fillStyle = '#000';
      ctx.fillRect(radiusInner - 1, -strokePx/2, strokePx + 2, strokePx);

      ctx.restore();
    }

    window.addEventListener('resize', resize);
    resize();

    socket.on('control', data => {
      if (data.dist !== undefined) currentDistM = data.dist;
      if (data.contrast !== undefined) { contrast = data.contrast; draw(); }

      if (data.start) {
        currentDistM = data.dist || 1.30;
        orientation = Math.floor(Math.random() * 4) * 90;
        contrast = 1.0;
        draw();

        setTimeout(() => { contrast = 0.25; draw(); }, data.changeSec || 1000);
      }
    });
  </script>
</body>
</html>